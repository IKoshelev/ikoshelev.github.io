(this["webpackJsonpui-app-architecture-showcases"]=this["webpackJsonpui-app-architecture-showcases"]||[]).push([[0],{25:function(e,t,a){},27:function(e,t,a){e.exports=a(38)},32:function(e,t,a){},36:function(e,t,a){},37:function(e,t,a){},38:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(18),o=a.n(i),c=(a(32),a(8)),s=a(9),l=Object(c.a)((function(e){var t,a=e.vm;return r.a.createElement("select",Object.assign({},null!==(t=e.selectAttributes)&&void 0!==t?t:{},{disabled:a.disabled,value:a.selectedItem?a.getKeyValue(a.selectedItem):"",onChange:function(e){var t=e.target.value,n=a.availableItems.find((function(e){return t===a.getKeyValue(e)}));if(!0===a.hasEmptyOption)a.handleSelect(n);else{if(void 0===n)throw new Error;a.handleSelect(n)}}}),a.hasEmptyOption&&r.a.createElement("option",{value:""},e.emptyPlaceholder),a.availableItems.map((function(e){var t=a.getKeyValue(e),n=a.getDescription(e);return r.a.createElement("option",{key:t,value:t},n)})))})),u=Object(c.a)((function(e){var t=e.vm;return t.isLoading?r.a.createElement("div",{className:"car-model-selector-loading"},"Loading"):r.a.createElement(r.a.Fragment,null,r.a.createElement(l,{selectAttributes:{className:"car-model-selector-select"},emptyPlaceholder:"Please select model",vm:{availableItems:t.availableModels,selectedItem:t.selectedModel,hasEmptyOption:!0,disabled:t.isDealFinilized,getKeyValue:function(e){return e.id.toString()},getDescription:function(e){return e.description},handleSelect:function(e){return t.setSelectedModel(e)}}}),r.a.createElement("button",{className:"car-model-selector-refresh-btn",onClick:t.reloadAvailableModels,disabled:t.isDealFinilized},"Refresh available models"))})),p=Object(c.a)((function(e){var t,a=e.vm;return r.a.createElement("select",Object.assign({},null!==(t=e.selectAttributes)&&void 0!==t?t:{},{multiple:!0,disabled:a.disabled,value:a.selectedItems.map((function(e){return a.getKeyValue(e)})),onChange:function(e){for(var t=e.target.options,n=[],r=0,i=t.length;r<i;r++)t[r].selected&&n.push(t[r].value);var o=a.availableItems.filter((function(e){return n.some((function(t){return t===a.getKeyValue(e)}))}));a.handleSelect(o)}}),a.availableItems.map((function(e){var t=a.getKeyValue(e),n=a.getDescription(e);return r.a.createElement("option",{key:t,value:t},n)})))})),d=Object(c.a)((function(e){var t=e.vm;return t.isLoading?r.a.createElement("div",{className:"insurance-plan-selector-loading"},"Loading"):r.a.createElement(r.a.Fragment,null,r.a.createElement(p,{selectAttributes:{className:"insurance-plan-selector-select"},vm:{availableItems:t.availablePlans,selectedItems:t.selectedPlans,disabled:t.isDealFinilized,getKeyValue:function(e){return e.type.toString()},getDescription:function(e){return e.description},handleSelect:function(e){return t.setSelectedPlans(e)}}}),r.a.createElement("button",{className:"insurance-plan-selector-refresh-btn",onClick:t.reloadAvailablePlans,disabled:t.isDealFinilized},"Refresh available plans"))})),h=Object(c.a)((function(e){var t,a,n,i,o=e.vm;return r.a.createElement(r.a.Fragment,null,r.a.createElement("input",Object.assign({},null!==(t=e.inputAttributes)&&void 0!==t?t:{},{className:(null!==(a=null===(n=e.inputAttributes)||void 0===n?void 0:n.className)&&void 0!==a?a:"")+(o.isValid?"":" invalid"),value:o.displayedValue,placeholder:e.placeholder,disabled:o.disabled,onChange:function(e){return o.onChange(e.target.value)},onBlur:function(e){return o.onBlur(e.target.value)}})),o.message&&r.a.createElement("div",null!==(i=e.messageAttributes)&&void 0!==i?i:{},o.message))})),b=(a(25),Object(c.a)((function(e){var t=e.vm;return r.a.createElement("div",{className:"car-purchase-deal"},r.a.createElement(v,{vm:t}))}))),v=Object(c.a)((function(e){var t=e.vm;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"car-purchase-model-selector-label"},"Please select model"),r.a.createElement(u,{vm:t.carModelSelectorVM}),r.a.createElement("div",{className:"car-purchase-insurance-selector-label"},"Please select insurance options"),r.a.createElement(d,{vm:t.insurancePlanSelectorVM}),r.a.createElement("div",{className:"car-purchase-downpayment-label"},"Please select downpayment"),r.a.createElement(h,{inputAttributes:{className:"car-purchase-downpayment"},messageAttributes:{className:"car-purchase-downpayment-messages"},vm:t.downpaymentInputVm}),r.a.createElement("button",{className:"button-set-minimum-possible-downpayment",disabled:!t.canSetMinimumPossibleDownpayment,onClick:t.setMinimumPossibleDownpayment},"Set minimum possible"),r.a.createElement("div",{className:"car-purchase-final-price-label"},"Final price"),r.a.createElement("div",{className:"car-final-price"},t.finalPrice),r.a.createElement(s.a,null,(function(){return console.log("Rendering deal state",new Date),r.a.createElement(r.a.Fragment,null,"no-approval"!==t.dealState&&r.a.createElement("div",{className:"car-purchase-deal-state"},function(e){if("deal-finalized"===e)return"Congratulations! Deal is finalized.";if("no-approval"===e)return"";if("approval-perpetual"===e)return"Approval granted.";if("approval-expired"===e)return"Approval expired.";return"Approval granted. Expires in ".concat(e.approvalExpiresInSeconds," seconds.")}(t.dealState)))})),r.a.createElement("button",{className:"button-request-approval",disabled:!t.canRequestApproval,onClick:t.getApproval},"Request approval"),r.a.createElement("button",{className:"button-close-active-deal",onClick:t.close},"Close this deal"),r.a.createElement("button",{className:"button-finalzie-deal",disabled:!t.canFinalizeDeal,onClick:t.finalzieDeal},"Finalize deal"),t.messages.length>0&&r.a.createElement("div",{className:"car-purchase-messages"},t.messages.map((function(e){return r.a.createElement("div",{key:e},e)}))))})),y=a(5),f=a(6),m=a(7),g=a(2),O=(a(12),a(11)),j=a(3),w=a.n(j),P=a(4),D=a(1),M=a(26),k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((function(t){return setTimeout(t,e)}))};var V,A=function(){function e(t){Object(f.a)(this,e),this._instance=void 0,this._initialize=void 0,this._initialize=t}return Object(m.a)(e,[{key:"val",get:function(){var e;return this._instance=null!==(e=this._instance)&&void 0!==e?e:this._initialize(),this._instance}}]),e}();!function(e){e[e.base=0]="base",e[e.thridParty=1]="thridParty",e[e.assetProtection=2]="assetProtection"}(V||(V={}));var C,S,F=function(){function e(){Object(f.a)(this,e)}return Object(m.a)(e,[{key:"getAvaliableInsurancePlans",value:function(){var e=Object(P.a)(w.a.mark((function e(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("server call getAvaliableInsurancePlans"),e.next=3,k(1500);case 3:return e.abrupt("return",[{type:V.base,description:"base plan",rate:.05},{type:V.thridParty,description:"3rd-party liability",rate:.05},{type:V.assetProtection,description:"asset protection",rate:.3}]);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}(),E=new A((function(){return new F})),x=a(16),z=a.n(x),L=a(17);!function(e){e.USD="USD",e.EUR="EUR",e.GBP="GBP",e.CHF="CHF"}(S||(S={}));var R=(C={},Object(L.a)(C,S.USD,1),Object(L.a)(C,S.EUR,.93),Object(L.a)(C,S.GBP,.83),Object(L.a)(C,S.CHF,.97),C),I=function(){function e(){Object(f.a)(this,e)}return Object(m.a)(e,[{key:"getCurrencies",value:function(){var e=Object(P.a)(w.a.mark((function e(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("server call getCurrencies"),e.next=3,k(1e3);case 3:return e.abrupt("return",[S.USD,S.EUR,S.GBP,S.CHF]);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getExchangeRate",value:function(){var e=Object(P.a)(w.a.mark((function e(t){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("server call getExchangeRate"),e.next=3,k(1e3);case 3:return e.abrupt("return",R[t]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),N=new A((function(){return new I})),U=[];function _(e){var t={isApproved:!0,expiration:e,approvalToken:Math.random().toString()};return U.push(t),t}var B,T,H,q,K,W,G,J,X=function(){function e(){Object(f.a)(this,e)}return Object(m.a)(e,[{key:"getMinimumPossibleDownpayment",value:function(){var e=Object(P.a)(w.a.mark((function e(t,a){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("server call getMinimumPossibleDownpayment"),e.next=3,k(1e3);case 3:if(!a.some((function(e){return e===V.assetProtection}))){e.next=5;break}return e.abrupt("return",t.basePriceUSD/10);case 5:return e.abrupt("return",t.basePriceUSD/5);case 6:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getMinimumPossibleDownpaymentInForeignCurrency",value:function(){var e=Object(P.a)(w.a.mark((function e(t,a,n){var r,i,o,c;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("server call getMinimumPossibleDownpaymentInForeignCurrency"),e.next=3,Promise.all([this.getMinimumPossibleDownpayment(t,a),N.val.getExchangeRate(n)]);case 3:return r=e.sent,i=Object(M.a)(r,2),o=i[0],c=i[1],e.abrupt("return",o*c);case 8:case"end":return e.stop()}}),e,this)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"getApproval",value:function(){var e=Object(P.a)(w.a.mark((function e(t,a,n){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("server call getApproval"),e.next=3,k(1e3);case 3:if(!(a.some((function(e){return e===V.assetProtection}))&&t.basePriceUSD/10<=n)){e.next=5;break}return e.abrupt("return",_());case 5:if(!(t.basePriceUSD/5<=n)){e.next=7;break}return e.abrupt("return",_(z()().add(15+30*Math.random(),"s").toDate()));case 7:return e.abrupt("return",{isApproved:!1,message:"Approval denied. Downpayment should be over 20% of base price (10% with 'asset protection' insurance)."});case 8:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"getApprovalWithForeignCurrency",value:function(){var e=Object(P.a)(w.a.mark((function e(t,a,n,r){var i,o;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("server call getApprovalWithForeignCurrency"),e.next=3,N.val.getExchangeRate(r);case 3:return i=e.sent,o=n/i+1,e.abrupt("return",this.getApproval(t,a,o));case 6:case"end":return e.stop()}}),e,this)})));return function(t,a,n,r){return e.apply(this,arguments)}}()},{key:"finalizeFinancing",value:function(){var e=Object(P.a)(w.a.mark((function e(t){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("server call finalizeFinancing"),e.next=3,k(500);case 3:return e.abrupt("return",U.some((function(e){return e.approvalToken===t&&(!e.expiration||e.expiration>=new Date)})));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),$=new A((function(){return new X})),Q=Object(D.n)({lastTickDate:new Date});setInterval(Object(D.f)((function(){Q.lastTickDate=new Date})),1e3);var Y,Z,ee,te,ae,ne,re,ie,oe,ce,se,le,ue,pe,de,he,be,ve,ye,fe,me,ge,Oe,je,we,Pe,De,Me,ke,Ve,Ae,Ce,Se,Fe,Ee,xe,ze,Le,Re,Ie,Ne=(B=function(){function e(){Object(f.a)(this,e),Object(y.a)(this,"carModel",T,this),Object(y.a)(this,"insurancePlansSelected",H,this),Object(y.a)(this,"downpayment",q,this),Object(y.a)(this,"isDealFinalized",K,this),Object(y.a)(this,"isLoading",W,this),Object(y.a)(this,"_messages",G,this),Object(y.a)(this,"fincingApprovalsCache",J,this)}return Object(m.a)(e,[{key:"construtor",value:function(){}},{key:"currentStateMatchesApprovalItem",value:function(e){var t;return(null===(t=this.carModel)||void 0===t?void 0:t.id)===e.carModelId&&this.downpayment===e.downpayment&&function(e,t){var a=new Set([].concat(Object(O.a)(e),Object(O.a)(t))).size;return a===e.length&&a===t.length}(this.insurancePlansSelected,e.insurancePlansSelected)}},{key:"getApproval",value:function(){var e=Object(P.a)(w.a.mark((function e(){var t;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.isLoading=!0,e.prev=1,e.next=4,$.val.getApproval(this.carModel,this.insurancePlansSelected,this.downpayment);case 4:t=e.sent,this.fincingApprovalsCache.push({carModelId:this.carModel.id,insurancePlansSelected:Object(O.a)(this.insurancePlansSelected),downpayment:this.downpayment,timestamp:new Date,approvalResponse:t});case 6:return e.prev=6,this.isLoading=!1,e.finish(6);case 9:case"end":return e.stop()}}),e,this,[[1,,6,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"finalizeDeal",value:function(){var e=Object(P.a)(w.a.mark((function e(){var t;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isLoading=!0,this._messages=[],e.prev=2,null===(t=this.financingApprovalResponseForCurrentDeal)||void 0===t?void 0:t.isApproved){e.next=5;break}throw new Error("Invalid state.");case 5:return e.next=7,$.val.finalizeFinancing(this.financingApprovalResponseForCurrentDeal.approvalToken);case 7:if(e.sent){e.next=11;break}return this._messages.push("Deal finalization failed."),e.abrupt("return");case 11:this.isDealFinalized=!0;case 12:return e.prev=12,this.isLoading=!1,e.finish(12);case 15:case"end":return e.stop()}}),e,this,[[2,,12,15]])})));return function(){return e.apply(this,arguments)}}()},{key:"messages",get:function(){var e=this.financingApprovalResponseForCurrentDeal;return[].concat(Object(O.a)(this._messages),Object(O.a)(!1===(null===e||void 0===e?void 0:e.isApproved)?[e.message]:[]))}},{key:"financingApprovalResponseForCurrentDeal",get:function(){var e,t,a=this;return null===(e=this.fincingApprovalsCache.filter((function(e){return a.currentStateMatchesApprovalItem(e)})).sort((t=function(e){return e.timestamp},function(e,a){var n=t(e);return t(a).valueOf()-n.valueOf()}))[0])||void 0===e?void 0:e.approvalResponse}},{key:"canRequestApproval",get:function(){return this.carModel&&!1===this.isDealFinalized&&!this.hasValidFinancingApproval}},{key:"canFinalizeDeal",get:function(){return!1===this.isDealFinalized&&this.hasValidFinancingApproval}},{key:"hasValidFinancingApproval",get:function(){var e=this.financingApprovalResponseForCurrentDeal;return e&&e.isApproved&&(!e.expiration||e.expiration>=Q.lastTickDate)}}]),e}(),T=Object(g.a)(B.prototype,"carModel",[D.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),H=Object(g.a)(B.prototype,"insurancePlansSelected",[D.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),q=Object(g.a)(B.prototype,"downpayment",[D.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),K=Object(g.a)(B.prototype,"isDealFinalized",[D.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),W=Object(g.a)(B.prototype,"isLoading",[D.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),G=Object(g.a)(B.prototype,"_messages",[D.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Object(g.a)(B.prototype,"messages",[D.g],Object.getOwnPropertyDescriptor(B.prototype,"messages"),B.prototype),Object(g.a)(B.prototype,"financingApprovalResponseForCurrentDeal",[D.g],Object.getOwnPropertyDescriptor(B.prototype,"financingApprovalResponseForCurrentDeal"),B.prototype),J=Object(g.a)(B.prototype,"fincingApprovalsCache",[D.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Object(g.a)(B.prototype,"canRequestApproval",[D.g],Object.getOwnPropertyDescriptor(B.prototype,"canRequestApproval"),B.prototype),Object(g.a)(B.prototype,"getApproval",[D.f],Object.getOwnPropertyDescriptor(B.prototype,"getApproval"),B.prototype),Object(g.a)(B.prototype,"canFinalizeDeal",[D.g],Object.getOwnPropertyDescriptor(B.prototype,"canFinalizeDeal"),B.prototype),Object(g.a)(B.prototype,"hasValidFinancingApproval",[D.g],Object.getOwnPropertyDescriptor(B.prototype,"hasValidFinancingApproval"),B.prototype),Object(g.a)(B.prototype,"finalizeDeal",[D.f],Object.getOwnPropertyDescriptor(B.prototype,"finalizeDeal"),B.prototype),B),Ue=function(){function e(){Object(f.a)(this,e)}return Object(m.a)(e,[{key:"getAvaliableCarModels",value:function(){var e=Object(P.a)(w.a.mark((function e(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("server call getAvaliableCarModels"),e.next=3,k(500);case 3:return e.abrupt("return",[{id:1,description:"Hetman Speedster",basePriceUSD:1e5},{id:2,description:"Hetman Workhorse",basePriceUSD:26e3},{id:3,description:"Hetman Luxury",basePriceUSD:9e4}]);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}(),_e=new A((function(){return new Ue})),Be=(Y=D.f.bound,Z=D.f.bound,ee=function(){function e(t){Object(f.a)(this,e),this.carPurchaseModel=void 0,Object(y.a)(this,"availableModels",te,this),Object(y.a)(this,"isLoading",ae,this),this.carPurchaseModel=t,this.reloadAvailableModels()}return Object(m.a)(e,[{key:"reloadAvailableModels",value:function(){var e=Object(P.a)(w.a.mark((function e(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.isLoading=!0,e.prev=1,e.next=4,_e.val.getAvaliableCarModels();case 4:this.availableModels=e.sent;case 5:return e.prev=5,this.isLoading=!1,e.finish(5);case 8:case"end":return e.stop()}}),e,this,[[1,,5,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"setSelectedModel",value:function(){var e=Object(P.a)(w.a.mark((function e(t){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.carPurchaseModel.carModel=t;case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isDealFinilized",get:function(){return this.carPurchaseModel.isDealFinalized}},{key:"selectedModel",get:function(){return this.carPurchaseModel.carModel}}]),e}(),te=Object(g.a)(ee.prototype,"availableModels",[D.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ae=Object(g.a)(ee.prototype,"isLoading",[D.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(g.a)(ee.prototype,"reloadAvailableModels",[Y],Object.getOwnPropertyDescriptor(ee.prototype,"reloadAvailableModels"),ee.prototype),Object(g.a)(ee.prototype,"isDealFinilized",[D.g],Object.getOwnPropertyDescriptor(ee.prototype,"isDealFinilized"),ee.prototype),Object(g.a)(ee.prototype,"selectedModel",[D.g],Object.getOwnPropertyDescriptor(ee.prototype,"selectedModel"),ee.prototype),Object(g.a)(ee.prototype,"setSelectedModel",[Z],Object.getOwnPropertyDescriptor(ee.prototype,"setSelectedModel"),ee.prototype),ee),Te=(ne=D.f.bound,re=D.f.bound,ie=function(){function e(t){Object(f.a)(this,e),this.carPurchaseModel=void 0,Object(y.a)(this,"availablePlans",oe,this),Object(y.a)(this,"isLoading",ce,this),this.carPurchaseModel=t,this.reloadAvailablePlans()}return Object(m.a)(e,[{key:"reloadAvailablePlans",value:function(){var e=Object(P.a)(w.a.mark((function e(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.isLoading=!0,e.prev=1,e.next=4,E.val.getAvaliableInsurancePlans();case 4:this.availablePlans=e.sent;case 5:return e.prev=5,this.isLoading=!1,e.finish(5);case 8:case"end":return e.stop()}}),e,this,[[1,,5,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"setSelectedPlans",value:function(){var e=Object(P.a)(w.a.mark((function e(t){var a;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=t.map((function(e){return e.type})),this.carPurchaseModel.insurancePlansSelected=a;case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isDealFinilized",get:function(){return this.carPurchaseModel.isDealFinalized}},{key:"selectedPlans",get:function(){var e=this;return this.availablePlans.filter((function(t){return e.carPurchaseModel.insurancePlansSelected.some((function(e){return e===t.type}))}))}}]),e}(),oe=Object(g.a)(ie.prototype,"availablePlans",[D.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ce=Object(g.a)(ie.prototype,"isLoading",[D.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(g.a)(ie.prototype,"reloadAvailablePlans",[ne],Object.getOwnPropertyDescriptor(ie.prototype,"reloadAvailablePlans"),ie.prototype),Object(g.a)(ie.prototype,"isDealFinilized",[D.g],Object.getOwnPropertyDescriptor(ie.prototype,"isDealFinilized"),ie.prototype),Object(g.a)(ie.prototype,"selectedPlans",[D.g],Object.getOwnPropertyDescriptor(ie.prototype,"selectedPlans"),ie.prototype),Object(g.a)(ie.prototype,"setSelectedPlans",[re],Object.getOwnPropertyDescriptor(ie.prototype,"setSelectedPlans"),ie.prototype),ie),He=(se=D.f.bound,le=D.f.bound,ue=D.f.bound,pe=function(){function e(t,a,n,r){var i=this;Object(f.a)(this,e),this.getModelValue=void 0,this.setValidValueToModel=void 0,this.isDisabled=void 0,this.additionalValidity=void 0,Object(y.a)(this,"currentUnsavedValue",de,this),Object(y.a)(this,"_message",he,this),Object(y.a)(this,"_isValid",be,this),this.getModelValue=t,this.setValidValueToModel=a,this.isDisabled=null!==n&&void 0!==n?n:function(){return!1},this.additionalValidity=null!==r&&void 0!==r?r:function(){return{isValid:!0}},Object(D.o)((function(){return i.getModelValue()}),(function(){return i.clearUnsavedState()}))}return Object(m.a)(e,[{key:"onChange",value:function(e){this.currentUnsavedValue=e}},{key:"clearUnsavedState",value:function(){this.currentUnsavedValue=void 0,this._message=void 0,this._isValid=!0}},{key:"onBlur",value:function(e){if(this.clearUnsavedState(),void 0!==e){if("-"===(e=e.trim().replace("k","000").replace("K","000").replace("m","000000").replace("M","000000"))[0])return this._isValid=!1,this._message="Value must be 0 or positive",void(this.currentUnsavedValue=e);if(!(!0===/^\d+$/.test(e)))return this._isValid=!1,this._message="Please enter a valid integer",void(this.currentUnsavedValue=e);var t=parseInt(e);this.setValidValueToModel(t)}else this.setValidValueToModel(e)}},{key:"displayedValue",get:function(){var e,t;return null!==(e=this.currentUnsavedValue)&&void 0!==e?e:null===(t=this.getModelValue())||void 0===t?void 0:t.toString()}},{key:"disabled",get:function(){return this.isDisabled()}},{key:"message",get:function(){var e;return null!==(e=this._message)&&void 0!==e?e:this.additionalValidity().message}},{key:"isValid",get:function(){return this._isValid&&this.additionalValidity().isValid}}]),e}(),Object(g.a)(pe.prototype,"displayedValue",[D.g],Object.getOwnPropertyDescriptor(pe.prototype,"displayedValue"),pe.prototype),de=Object(g.a)(pe.prototype,"currentUnsavedValue",[D.n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Object(g.a)(pe.prototype,"disabled",[D.g],Object.getOwnPropertyDescriptor(pe.prototype,"disabled"),pe.prototype),he=Object(g.a)(pe.prototype,"_message",[D.n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Object(g.a)(pe.prototype,"message",[D.g],Object.getOwnPropertyDescriptor(pe.prototype,"message"),pe.prototype),be=Object(g.a)(pe.prototype,"_isValid",[D.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Object(g.a)(pe.prototype,"isValid",[D.g],Object.getOwnPropertyDescriptor(pe.prototype,"isValid"),pe.prototype),Object(g.a)(pe.prototype,"onChange",[se],Object.getOwnPropertyDescriptor(pe.prototype,"onChange"),pe.prototype),Object(g.a)(pe.prototype,"clearUnsavedState",[le],Object.getOwnPropertyDescriptor(pe.prototype,"clearUnsavedState"),pe.prototype),Object(g.a)(pe.prototype,"onBlur",[ue],Object.getOwnPropertyDescriptor(pe.prototype,"onBlur"),pe.prototype),pe),qe=(ve=D.f.bound,ye=D.f.bound,fe=D.f.bound,me=D.f.bound,ge=function(){function e(t,a){Object(f.a)(this,e),this.cssClassName="car-purchase-deal",this.id=void 0,this.onClose=void 0,this.carPurchaseModel=void 0,this.carModelSelectorVM=void 0,this.insurancePlanSelectorVM=void 0,Object(y.a)(this,"_isLoading",Oe,this),this.downpaymentInputVm=void 0,this.id=t,this.onClose=a,this.carPurchaseModel=this.createModel(),this.carModelSelectorVM=new Be(this.carPurchaseModel),this.insurancePlanSelectorVM=new Te(this.carPurchaseModel),this.downpaymentInputVm=this.createDownpaymentVM()}return Object(m.a)(e,[{key:"createModel",value:function(){return new Ne}},{key:"headerAdditionalDescription",value:function(){return""}},{key:"calculateFinalPriceFromBase",value:function(e){var t=this.insurancePlanSelectorVM.selectedPlans.map((function(t){return e*t.rate})).reduce((function(e,t){return e+t}),0);return e+t}},{key:"createDownpaymentVM",value:function(){var e=this;return new He((function(){return e.carPurchaseModel.downpayment}),(function(t){return e.carPurchaseModel.downpayment=null!==t&&void 0!==t?t:0}),(function(){return e.isDealFinilized}),(function(){return e.finalPrice&&e.carPurchaseModel.downpayment>e.finalPrice?{isValid:!1,message:"Downpayment exceeds final price"}:{isValid:!0}}))}},{key:"getApproval",value:function(){var e=Object(P.a)(w.a.mark((function e(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.carPurchaseModel.getApproval();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"finalzieDeal",value:function(){var e=Object(P.a)(w.a.mark((function e(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.carPurchaseModel.finalizeDeal();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setMinimumPossibleDownpayment",value:function(){var e=Object(P.a)(w.a.mark((function e(){var t,a=this;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._isLoading=!0,e.prev=1,e.next=4,this.getMinimumPossibleDownpaymentFromServer();case 4:t=e.sent,Object(D.p)((function(){a.carPurchaseModel.downpayment!==t?a.carPurchaseModel.downpayment=t:a.downpaymentInputVm.clearUnsavedState()}));case 6:return e.prev=6,this._isLoading=!1,e.finish(6);case 9:case"end":return e.stop()}}),e,this,[[1,,6,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"getMinimumPossibleDownpaymentFromServer",value:function(){var e=Object(P.a)(w.a.mark((function e(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",$.val.getMinimumPossibleDownpayment(this.carPurchaseModel.carModel,this.carPurchaseModel.insurancePlansSelected));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"close",value:function(){var e;null===(e=this.onClose)||void 0===e||e.call(this,this)}},{key:"messages",get:function(){return Object(O.a)(this.carPurchaseModel.messages)}},{key:"isLoading",get:function(){return this._isLoading||this.insurancePlanSelectorVM.isLoading||this.carModelSelectorVM.isLoading||this.carPurchaseModel.isLoading}},{key:"tabHeader",get:function(){if(!this.carPurchaseModel.carModel)return"".concat(this.id);var e="";return"deal-finalized"===this.dealState?e="done":"approval-perpetual"===this.dealState?e="approved":"string"!==typeof this.dealState&&(e="".concat(this.dealState.approvalExpiresInSeconds," sec")),"".concat(this.carPurchaseModel.carModel.description," ").concat(this.headerAdditionalDescription()," ").concat(e)}},{key:"finalPrice",get:function(){var e,t=null===(e=this.carPurchaseModel.carModel)||void 0===e?void 0:e.basePriceUSD;if(void 0!==t)return this.calculateFinalPriceFromBase(t)}},{key:"dealState",get:function(){if(this.carPurchaseModel.isDealFinalized)return"deal-finalized";var e=this.carPurchaseModel.financingApprovalResponseForCurrentDeal;if(!e||!1===e.isApproved)return"no-approval";var t=e.expiration;if(!t)return"approval-perpetual";var a=z.a.duration(z()(t).diff(Q.lastTickDate)),n=Math.round(a.asSeconds());return n<=0?"approval-expired":{approvalExpiresInSeconds:n}}},{key:"isValid",get:function(){return!this.isLoading&&this.downpaymentInputVm.isValid}},{key:"canRequestApproval",get:function(){return this.carPurchaseModel.canRequestApproval&&!this.isLoading&&this.isValid}},{key:"isDealFinilized",get:function(){return this.carPurchaseModel.isDealFinalized}},{key:"canFinalizeDeal",get:function(){return this.carPurchaseModel.canFinalizeDeal&&!this.isLoading&&this.isValid}},{key:"canSetMinimumPossibleDownpayment",get:function(){return void 0!==this.carPurchaseModel.carModel&&!this.isDealFinilized&&!this.isLoading}}]),e}(),Oe=Object(g.a)(ge.prototype,"_isLoading",[D.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(g.a)(ge.prototype,"messages",[D.g],Object.getOwnPropertyDescriptor(ge.prototype,"messages"),ge.prototype),Object(g.a)(ge.prototype,"isLoading",[D.g],Object.getOwnPropertyDescriptor(ge.prototype,"isLoading"),ge.prototype),Object(g.a)(ge.prototype,"tabHeader",[D.g],Object.getOwnPropertyDescriptor(ge.prototype,"tabHeader"),ge.prototype),Object(g.a)(ge.prototype,"finalPrice",[D.g],Object.getOwnPropertyDescriptor(ge.prototype,"finalPrice"),ge.prototype),Object(g.a)(ge.prototype,"dealState",[D.g],Object.getOwnPropertyDescriptor(ge.prototype,"dealState"),ge.prototype),Object(g.a)(ge.prototype,"isValid",[D.g],Object.getOwnPropertyDescriptor(ge.prototype,"isValid"),ge.prototype),Object(g.a)(ge.prototype,"canRequestApproval",[D.g],Object.getOwnPropertyDescriptor(ge.prototype,"canRequestApproval"),ge.prototype),Object(g.a)(ge.prototype,"getApproval",[ve],Object.getOwnPropertyDescriptor(ge.prototype,"getApproval"),ge.prototype),Object(g.a)(ge.prototype,"isDealFinilized",[D.g],Object.getOwnPropertyDescriptor(ge.prototype,"isDealFinilized"),ge.prototype),Object(g.a)(ge.prototype,"canFinalizeDeal",[D.g],Object.getOwnPropertyDescriptor(ge.prototype,"canFinalizeDeal"),ge.prototype),Object(g.a)(ge.prototype,"finalzieDeal",[ye],Object.getOwnPropertyDescriptor(ge.prototype,"finalzieDeal"),ge.prototype),Object(g.a)(ge.prototype,"canSetMinimumPossibleDownpayment",[D.g],Object.getOwnPropertyDescriptor(ge.prototype,"canSetMinimumPossibleDownpayment"),ge.prototype),Object(g.a)(ge.prototype,"setMinimumPossibleDownpayment",[fe],Object.getOwnPropertyDescriptor(ge.prototype,"setMinimumPossibleDownpayment"),ge.prototype),Object(g.a)(ge.prototype,"close",[me],Object.getOwnPropertyDescriptor(ge.prototype,"close"),ge.prototype),ge),Ke=a(14),We=a(13),Ge=a(21),Je=a(22),Xe=a(20),$e=(je=function(e){Object(Je.a)(a,e);var t=Object(Xe.a)(a);function a(){var e;Object(f.a)(this,a);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),Object(y.a)(e,"downpaymentCurrency",we,Object(Ke.a)(e)),Object(y.a)(e,"fincingApprovalsCache",Pe,Object(Ke.a)(e)),e}return Object(m.a)(a,[{key:"currentStateMatchesApprovalItem",value:function(e){return Object(Ge.a)(Object(We.a)(a.prototype),"currentStateMatchesApprovalItem",this).call(this,e)&&this.downpaymentCurrency===e.downpaymentCurrency}},{key:"getApproval",value:function(){var e=Object(P.a)(w.a.mark((function e(){var t;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.isLoading=!0,e.prev=1,e.next=4,$.val.getApprovalWithForeignCurrency(this.carModel,this.insurancePlansSelected,this.downpayment,this.downpaymentCurrency);case 4:t=e.sent,this.fincingApprovalsCache.push({carModelId:this.carModel.id,insurancePlansSelected:Object(O.a)(this.insurancePlansSelected),downpayment:this.downpayment,timestamp:new Date,approvalResponse:t,downpaymentCurrency:this.downpaymentCurrency});case 6:return e.prev=6,this.isLoading=!1,e.finish(6);case 9:case"end":return e.stop()}}),e,this,[[1,,6,9]])})));return function(){return e.apply(this,arguments)}}()}]),a}(Ne),we=Object(g.a)(je.prototype,"downpaymentCurrency",[D.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return S.USD}}),Pe=Object(g.a)(je.prototype,"fincingApprovalsCache",[D.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Object(g.a)(je.prototype,"getApproval",[D.f],Object.getOwnPropertyDescriptor(je.prototype,"getApproval"),je.prototype),je),Qe=N.val.getCurrencies(),Ye=(De=D.f.bound,Me=function(){function e(t,a,n){var r=this;Object(f.a)(this,e),this.getModelValue=void 0,this.setValueToModel=void 0,this.isDisabled=void 0,Object(y.a)(this,"availableCurrencies",ke,this),Object(y.a)(this,"isLoading",Ve,this),this.getModelValue=t,this.setValueToModel=a,this.isDisabled=null!==n&&void 0!==n?n:function(){return!1},this.isLoading=!0,Qe.then(Object(D.f)((function(e){r.availableCurrencies=e,r.isLoading=!1})))}return Object(m.a)(e,[{key:"onChange",value:function(e){this.setValueToModel(e)}},{key:"selectedCurrency",get:function(){return this.getModelValue()}},{key:"disabled",get:function(){return this.isLoading||this.isDisabled()}}]),e}(),ke=Object(g.a)(Me.prototype,"availableCurrencies",[D.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ve=Object(g.a)(Me.prototype,"isLoading",[D.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(g.a)(Me.prototype,"selectedCurrency",[D.g],Object.getOwnPropertyDescriptor(Me.prototype,"selectedCurrency"),Me.prototype),Object(g.a)(Me.prototype,"disabled",[D.g],Object.getOwnPropertyDescriptor(Me.prototype,"disabled"),Me.prototype),Object(g.a)(Me.prototype,"onChange",[De],Object.getOwnPropertyDescriptor(Me.prototype,"onChange"),Me.prototype),Me),Ze=(Ae=D.f.bound,Ce=function(e){Object(Je.a)(a,e);var t=Object(Xe.a)(a);function a(e,n){var r;return Object(f.a)(this,a),(r=t.call(this,e,n)).carPurchaseModel=r.carPurchaseModel,r.currencySelector=new Ye((function(){return r.carPurchaseModel.downpaymentCurrency}),(function(e){return r.carPurchaseModel.downpaymentCurrency=e}),(function(){return r.isDealFinilized})),Object(y.a)(r,"exchangeRate",Se,Object(Ke.a)(r)),r.foreignCuurencyHandlingCoeficient=1.02,Object(D.o)((function(){return r.carPurchaseModel.downpaymentCurrency}),(function(e){return r.reloadExchangeRate()}),{fireImmediately:!0}),r}return Object(m.a)(a,[{key:"createModel",value:function(){return new $e}},{key:"headerAdditionalDescription",value:function(){return" ".concat(this.carPurchaseModel.downpaymentCurrency," ")}},{key:"reloadExchangeRate",value:function(){var e=Object(P.a)(w.a.mark((function e(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._isLoading=!0,this.exchangeRate=void 0,e.prev=2,e.next=5,N.val.getExchangeRate(this.carPurchaseModel.downpaymentCurrency);case 5:this.exchangeRate=e.sent;case 6:return e.prev=6,this._isLoading=!1,e.finish(6);case 9:case"end":return e.stop()}}),e,this,[[2,,6,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"calculateFinalPriceFromBase",value:function(e){if(void 0!==this.exchangeRate){var t=e*this.exchangeRate,n=Object(Ge.a)(Object(We.a)(a.prototype),"calculateFinalPriceFromBase",this).call(this,t);if(n)return this.carPurchaseModel.downpaymentCurrency!==S.USD&&(n*=this.foreignCuurencyHandlingCoeficient),Math.round(n)}}},{key:"getMinimumPossibleDownpaymentFromServer",value:function(){var e=Object(P.a)(w.a.mark((function e(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",$.val.getMinimumPossibleDownpaymentInForeignCurrency(this.carPurchaseModel.carModel,this.carPurchaseModel.insurancePlansSelected,this.carPurchaseModel.downpaymentCurrency));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),a}(qe),Se=Object(g.a)(Ce.prototype,"exchangeRate",[D.n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Object(g.a)(Ce.prototype,"reloadExchangeRate",[Ae],Object.getOwnPropertyDescriptor(Ce.prototype,"reloadExchangeRate"),Ce.prototype),Ce),et=new(Fe=D.f.bound,Ee=D.f.bound,xe=D.f.bound,ze=D.f.bound,Le=function(){function e(){Object(f.a)(this,e),this.coutner=0,Object(y.a)(this,"capPurchaseVMs",Re,this),Object(y.a)(this,"activeCapPurchaseVM",Ie,this),this.addNewDeal()}return Object(m.a)(e,[{key:"addNewDeal",value:function(){this.coutner+=1;var e=new qe("Deal ".concat(this.coutner),this.closeDeal);this.capPurchaseVMs.push(e),this.activeCapPurchaseVM=e}},{key:"addForeignCurrencyDeal",value:function(){this.coutner+=1;var e=new Ze("Deal ".concat(this.coutner),this.closeDeal);this.capPurchaseVMs.push(e),this.activeCapPurchaseVM=e}},{key:"setActiveDeal",value:function(e){this.activeCapPurchaseVM=e}},{key:"closeDeal",value:function(e){var t=this.capPurchaseVMs.findIndex((function(t){return t===e}));if(-1!==t){var a;if(this.activeCapPurchaseVM===this.capPurchaseVMs[t])this.activeCapPurchaseVM=null!==(a=this.capPurchaseVMs[t-1])&&void 0!==a?a:this.capPurchaseVMs[t+1];this.capPurchaseVMs.splice(t,1)}}}]),e}(),Re=Object(g.a)(Le.prototype,"capPurchaseVMs",[D.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ie=Object(g.a)(Le.prototype,"activeCapPurchaseVM",[D.n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Object(g.a)(Le.prototype,"addNewDeal",[Fe],Object.getOwnPropertyDescriptor(Le.prototype,"addNewDeal"),Le.prototype),Object(g.a)(Le.prototype,"addForeignCurrencyDeal",[Ee],Object.getOwnPropertyDescriptor(Le.prototype,"addForeignCurrencyDeal"),Le.prototype),Object(g.a)(Le.prototype,"setActiveDeal",[xe],Object.getOwnPropertyDescriptor(Le.prototype,"setActiveDeal"),Le.prototype),Object(g.a)(Le.prototype,"closeDeal",[ze],Object.getOwnPropertyDescriptor(Le.prototype,"closeDeal"),Le.prototype),Le),tt=(a(36),Object(c.a)((function(e){var t=e.vm;return r.a.createElement(r.a.Fragment,null,r.a.createElement(l,{selectAttributes:e.selectAttributes,emptyPlaceholder:"",vm:{availableItems:t.availableCurrencies,selectedItem:t.selectedCurrency,hasEmptyOption:!1,getKeyValue:function(e){return e},getDescription:function(e){return e},handleSelect:function(e){return t.onChange(e)},disabled:t.disabled}}))}))),at=(a(37),Object(c.a)((function(e){var t=e.vm;return r.a.createElement("div",{className:"car-purchase-deal car-purchase-deal-with-foreign-currency"},r.a.createElement(v,{vm:t}),r.a.createElement("div",{className:"car-purchase-downpayment-currency-label"},"Please select currency"),r.a.createElement(tt,{selectAttributes:{className:"car-purchase-downpayment-currency"},vm:t.currencySelector}))}))),nt=Object(c.a)((function(){return r.a.createElement("div",{id:"app-root"},r.a.createElement("div",{className:"main-logo"},"Welcome to Hetman Motors (Mobx)"),r.a.createElement("div",{className:"screens"},r.a.createElement("div",{className:"tabs"},r.a.createElement("button",{className:"button-add-new-deal",onClick:et.addNewDeal},"Add deal"),r.a.createElement("button",{className:"button-add-new-deal",onClick:et.addForeignCurrencyDeal},"Add foreign currency deal"),et.capPurchaseVMs.map((function(e){return r.a.createElement("div",{className:"deal-tab-header ".concat(e===et.activeCapPurchaseVM?"active":""),key:e.id},r.a.createElement(s.a,null,(function(){return console.log("rendering header for ".concat(e.id)),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"header-text",onClick:function(){return et.setActiveDeal(e)}},e.tabHeader))})),r.a.createElement("button",{className:"close-button",onClick:e.close},"X"))}))),r.a.createElement("div",{className:"active-tab"},et.activeCapPurchaseVM&&function(e){if(e instanceof Ze)return r.a.createElement(at,{vm:e});if(e instanceof qe)return r.a.createElement(b,{vm:e})}(et.activeCapPurchaseVM))))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(nt,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[27,1,2]]]);
//# sourceMappingURL=main.d074c8d5.chunk.js.map